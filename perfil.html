<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usuário</title>
    <link rel="stylesheet" href="geral.css">
    <link rel="stylesheet" href="perfil.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    
    <nav class="main-navbar">
        <ul>
            <img src="logo/image.png" width="165" alt="Logo">
            <li><a href="home.html">Inicio</a></li>
            <li><a href="perdidos.html">Itens Perdidos</a></li>
            <li><a href="resgatados.html">Itens Resgatados</a></li>
            <li><a href="perfil.html">Perfil</a></li>
            <li><a href="registrar.html" class="diferente">+ Registrar Item</a></li> 
        </ul>
    </nav>
    
    <div class="linhaHorizontal"></div>

    <div class="layout-container">
        
        <nav class="menuvertical" aria-label="Menu de Navegação Secundário">
            <a href="home.html"><i class="fas fa-home"></i> Inicial</a>
            <a href="perdidos.html"><i class="fas fa-search-minus"></i> Item Perdido</a>
            <a href="resgatados.html"><i class="fas fa-search-plus"></i> Item Resgatados</a>
            <a href="perfil.html" class="active-sidebar"><i class="fas fa-cog"></i> Configurações</a> 
            <a href="login.html"><i class="fas fa-sign-out-alt"></i> Sair</a> 
        </nav>
        
        <main class="main-content-area">
            <h1>Meu Perfil</h1>
            
            <section class="profile-header">
                <div class="profile-avatar" id="avatarUpload">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="profile-info">
                    <h2 id="headerNome">Carregando...</h2>
                    <p id="headerMatricula">ID: ---</p>
                </div>
                <button class="btn-edit-profile" id="btnEdit"><i class="fas fa-edit"></i> Editar Perfil</button>
            </section>
            
            <section class="profile-details">
                <h2>Detalhes da Conta</h2>
                
                <div class="detail-group">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" disabled>
                </div>
                
                <div class="detail-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" disabled>
                </div>
                
                <div class="detail-group">
                    <label for="telefone">Telefone:</label>
                    <input type="tel" id="telefone" disabled>
                </div>

                <div class="detail-group">
                    <label for="localizacao">Campus:</label>
                    <input type="text" id="localizacao" disabled>
                </div>
                
                <button class="btn-change-password">Alterar Senha</button>
            </section>
            
        </main>
    </div>

    <footer class="footer">
        <div class="footer-links">
            <a href="#"><i class="fas fa-question-circle"></i> Ajuda</a>
            <span>•</span>
            <a href="#"><i class="fas fa-envelope"></i> Contato</a>
            <span>•</span>
            <a href="#"><i class="fas fa-info-circle"></i> Sobre</a>
        </div>
        <div class="copyright">
            <p>© 2025 Achados e Perdidos Online</p>
        </div>
    </footer>


<!-- ===========================
      SCRIPT DO PERFIL
=========================== -->
<script>
const API_URL = "https://back1-yktp.onrender.com/api/auth";
const token = localStorage.getItem("token");

if (!token) {
    window.location.href = "login.html";
}

// Buscar dados do usuário
async function carregarPerfil() {
    try {
        const resp = await fetch(`${API_URL}/me`, {
            headers: { "Authorization": "Bearer " + token }
        });

        const user = await resp.json();

        // Preencher campos
        document.getElementById("nome").value = user.nome;
        document.getElementById("email").value = user.email;
        document.getElementById("telefone").value = user.telefone || "";
        document.getElementById("localizacao").value = user.campus || "";

        // Header
        document.getElementById("headerNome").textContent = user.nome;
        document.getElementById("headerMatricula").textContent = "ID: " + user.id;

    } catch (err) {
        console.error(err);
        alert("Erro ao carregar perfil");
    }
}

carregarPerfil();

// Botão editar – habilita os inputs
document.getElementById("btnEdit").addEventListener("click", () => {
    document.querySelectorAll("input").forEach(i => {
        if (i.id !== "email") i.disabled = false;
    });

    // Transformar o botão em "Salvar"
    const btn = document.getElementById("btnEdit");
    btn.innerHTML = "<i class='fas fa-save'></i> Salvar";
    btn.onclick = salvarPerfil;
});

// Atualizar dados no backend
async function salvarPerfil() {
    const body = {
        nome: document.getElementById("nome").value,
        telefone: document.getElementById("telefone").value
    };

    try {
        const resp = await fetch(`${API_URL}/update`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify(body)
        });

        const data = await resp.json();
        alert("Perfil atualizado!");

        window.location.reload();

    } catch (err) {
        console.error(err);
        alert("Erro ao salvar alterações");
    }
}

// Avatar (futuro upload)
document.getElementById("avatarUpload").addEventListener("click", () => {
    alert("Upload de foto ainda não configurado no backend!");
});
</script>

</body>
</html>
