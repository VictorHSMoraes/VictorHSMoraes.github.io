<script>
// Preenche automaticamente data e hora quando a pÃ¡gina abre
document.addEventListener("DOMContentLoaded", () => {
    const agora = new Date();
    const dia = String(agora.getDate()).padStart(2, "0");
    const mes = String(agora.getMonth() + 1).padStart(2, "0");
    const ano = agora.getFullYear();

    const hora = String(agora.getHours()).padStart(2, "0");
    const minuto = String(agora.getMinutes()).padStart(2, "0");

    const dataHoraFormatada = `${dia}/${mes}/${ano} ${hora}:${minuto}`;

    document.getElementById("data_ocorrido").value = dataHoraFormatada;
});

// Envio para backend
document.getElementById("formItem").addEventListener("submit", async (e) => {
    e.preventDefault();

    const token = localStorage.getItem("token");
    if (!token) return alert("VocÃª precisa estar logado.");

    const formData = new FormData();
    formData.append("imagem", document.getElementById("imagem").files[0]);
    formData.append("titulo", document.getElementById("titulo").value);
    formData.append("descricao", document.getElementById("descricao").value);
    formData.append("categoria_id", document.getElementById("categoria_id").value);
    formData.append("local_id", document.getElementById("local_id").value);

    // ðŸ”¥ agora tambÃ©m envia a data automÃ¡tica
    formData.append("data_ocorrido", document.getElementById("data_ocorrido").value);

    const response = await fetch("https://back1-yktp.onrender.com/api/itens", {
        method: "POST",
        headers: {
            Authorization: "Bearer " + token
        },
        body: formData
    });

    const result = await response.json();

    if (response.ok) {
        alert("Item cadastrado com sucesso!");
        window.location.href = "home.html";
    } else {
        alert(result.message || "Erro ao cadastrar item");
    }
});
</script>
